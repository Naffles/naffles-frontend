<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Naffles Games Demo - Standalone</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom Naffles color palette */
        :root {
            --nafl-aqua-500: #02B1B1;
            --nafl-aqua-600: #028585;
            --nafl-sponge-500: #FEFF3D;
            --nafl-sponge-600: #BFBF2E;
            --nafl-grey-700: #2F2F2F;
            --nafl-grey-800: #212121;
            --nafl-grey-900: #181818;
            --nafl-purple: #DC2ABF;
        }
        
        .bg-nafl-aqua-500 { background-color: var(--nafl-aqua-500); }
        .bg-nafl-aqua-600 { background-color: var(--nafl-aqua-600); }
        .bg-nafl-sponge-500 { background-color: var(--nafl-sponge-500); }
        .bg-nafl-grey-700 { background-color: var(--nafl-grey-700); }
        .bg-nafl-grey-800 { background-color: var(--nafl-grey-800); }
        .bg-nafl-grey-900 { background-color: var(--nafl-grey-900); }
        .bg-nafl-purple { background-color: var(--nafl-purple); }
        
        .text-nafl-aqua-500 { color: var(--nafl-aqua-500); }
        .text-nafl-sponge-500 { color: var(--nafl-sponge-500); }
        .text-nafl-white { color: #FFFFFF; }
        .text-nafl-grey-300 { color: #A3A3A3; }
        .text-nafl-grey-400 { color: #C4C4C4; }
        .text-nafl-grey-500 { color: #626262; }
        
        .border-nafl-aqua-500 { border-color: var(--nafl-aqua-500); }
        .border-nafl-sponge-500 { border-color: var(--nafl-sponge-500); }
        
        /* Game-specific styles */
        .card {
            width: 64px;
            height: 96px;
            background: white;
            border-radius: 8px;
            border: 2px solid #ccc;
            position: relative;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-2px);
        }
        
        @keyframes cardDeal {
            from {
                transform: translateX(-200px) translateY(-100px) rotate(-45deg);
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }
        
        @keyframes cardReveal {
            0% {
                transform: rotateY(0deg);
            }
            50% {
                transform: rotateY(90deg);
            }
            100% {
                transform: rotateY(0deg);
            }
        }
        
        .card-deal {
            animation: cardDeal 0.8s ease-out;
        }
        
        .card-reveal {
            animation: cardReveal 0.6s ease-in-out;
        }
        
        .card.bg-blue-900 {
            background: linear-gradient(135deg, #1e3a8a, #1e40af);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        #blackjack-overlay {
            backdrop-filter: blur(5px);
            animation: fadeIn 0.3s ease-out;
        }

        .celebration-text {
            animation: celebrationPulse 0.6s ease-in-out;
        }

        .celebration-emojis {
            animation: celebrationBounce 0.8s ease-in-out;
        }

        @keyframes celebrationPulse {
            0%, 100% { 
                transform: scale(1);
                filter: brightness(1);
            }
            50% { 
                transform: scale(1.2);
                filter: brightness(1.5);
            }
        }

        @keyframes celebrationBounce {
            0%, 100% { 
                transform: translateY(0) scale(1);
            }
            25% { 
                transform: translateY(-10px) scale(1.1);
            }
            75% { 
                transform: translateY(-5px) scale(1.05);
            }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .chip {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            border: 4px solid;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 12px;
            cursor: pointer;
            transition: transform 0.2s ease;
        }
        
        .chip:hover {
            transform: scale(1.1);
        }
        
        .coin {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            border: 4px solid;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
            transition: transform 0.5s ease;
        }
        
        .coin.spinning {
            animation: spin 2s linear infinite;
        }
        
        @keyframes spin {
            from { transform: rotateY(0deg); }
            to { transform: rotateY(360deg); }
        }
        
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }
        
        .bounce {
            animation: bounce 1s ease-in-out;
        }
        
        .gesture-button {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            border: 3px solid var(--nafl-aqua-500);
            background: var(--nafl-grey-700);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .gesture-button:hover {
            background: var(--nafl-aqua-500);
            transform: scale(1.1);
        }
        
        .gesture-button.selected {
            background: var(--nafl-sponge-500);
            border-color: var(--nafl-sponge-500);
            color: black;
        }
        
        .starry-bg {
            background: linear-gradient(to bottom, #1e1b4b, #581c87, #000000);
            position: relative;
            overflow: hidden;
        }
        
        .star {
            position: absolute;
            width: 2px;
            height: 2px;
            background: white;
            border-radius: 50%;
            animation: twinkle 2s infinite;
        }
        
        @keyframes twinkle {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }
        
        .moon {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(135deg, #e5e7eb, #9ca3af);
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.3);
        }
        
        .moon::before {
            content: '';
            position: absolute;
            top: 10px;
            left: 15px;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #6b7280;
            opacity: 0.3;
        }
        
        .moon::after {
            content: '';
            position: absolute;
            bottom: 15px;
            right: 20px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #6b7280;
            opacity: 0.2;
        }
    </style>
</head>
<body class="bg-nafl-grey-900 text-nafl-white min-h-screen">
    <!-- Header -->
    <div class="bg-nafl-grey-800 border-b border-gray-700 p-4">
        <div class="max-w-6xl mx-auto flex items-center justify-between">
            <div>
                <h1 class="text-2xl font-bold text-nafl-white">üéÆ Naffles Games Demo</h1>
                <p class="text-nafl-grey-400 text-sm">Standalone demo with mock API simulation</p>
            </div>
            <div class="flex items-center gap-4">
                <div class="text-green-500 text-sm font-bold">‚úÖ Mock API Active</div>
                <button onclick="resetDemo()" class="bg-nafl-aqua-500 hover:bg-nafl-aqua-600 text-white px-3 py-1 rounded text-sm">
                    Reset Demo
                </button>
            </div>
        </div>
    </div>

    <!-- Game Selection -->
    <div class="max-w-6xl mx-auto p-6">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
            <button onclick="showGame('blackjack', event)" class="game-selector bg-nafl-grey-800 hover:bg-nafl-grey-700 border border-gray-600 hover:border-nafl-aqua-500 rounded-lg p-6 transition-all">
                <div class="text-4xl mb-2">üÉè</div>
                <h3 class="text-xl font-bold mb-2">Blackjack</h3>
                <p class="text-nafl-grey-400 text-sm">Crypto-themed casino experience</p>
            </button>
            
            <button onclick="showGame('coin-toss', event)" class="game-selector bg-nafl-grey-800 hover:bg-nafl-grey-700 border border-gray-600 hover:border-nafl-aqua-500 rounded-lg p-6 transition-all">
                <div class="text-4xl mb-2">ü™ô</div>
                <h3 class="text-xl font-bold mb-2">Coin Toss</h3>
                <p class="text-nafl-grey-400 text-sm">Moon-throw with Pepe & Bitcoin</p>
            </button>
            
            <button onclick="showGame('rps', event)" class="game-selector bg-nafl-grey-800 hover:bg-nafl-grey-700 border border-gray-600 hover:border-nafl-aqua-500 rounded-lg p-6 transition-all">
                <div class="text-4xl mb-2">‚úä</div>
                <h3 class="text-xl font-bold mb-2">Rock Paper Scissors</h3>
                <p class="text-nafl-grey-400 text-sm">Countdown-based gesture game</p>
            </button>
        </div>

        <!-- Game Container -->
        <div id="game-container" class="bg-nafl-grey-800 rounded-lg overflow-hidden">
            <div class="p-8 text-center">
                <div class="text-6xl mb-4">üéÆ</div>
                <h2 class="text-2xl font-bold mb-2">Select a Game to Start</h2>
                <p class="text-nafl-grey-400">Choose from Blackjack, Coin Toss, or Rock Paper Scissors above</p>
            </div>
        </div>

        <!-- Game Results -->
        <div id="results-container" class="mt-6 bg-nafl-grey-800 rounded-lg p-6" style="display: none;">
            <h3 class="text-lg font-bold mb-4">Game Results</h3>
            <div id="results-list" class="space-y-2"></div>
        </div>
    </div>

    <script>
        console.log('üîß Script starting...');
        
        // Mock API System
        class MockGameAPI {
            constructor() {
                this.requestCount = 0;
                this.rateLimit = 10;
                this.results = [];
            }

            async simulateDelay() {
                return new Promise(resolve => {
                    setTimeout(resolve, 300 + Math.random() * 700);
                });
            }

            checkRateLimit() {
                this.requestCount++;
                if (this.requestCount > this.rateLimit) {
                    throw new Error('Rate limit exceeded. Please wait before playing again.');
                }
                setTimeout(() => {
                    this.requestCount = Math.max(0, this.requestCount - 1);
                }, 60000);
            }

            async mockCoinToss(choice) {
                await this.simulateDelay();
                this.checkRateLimit();

                const outcomes = ['heads', 'tails'];
                const result = outcomes[Math.floor(Math.random() * outcomes.length)];
                const isWin = choice === result;
                
                return {
                    result: isWin ? 'win' : 'lose',
                    outcome: result,
                    score: isWin ? Math.floor(Math.random() * 50) + 10 : Math.floor(Math.random() * 10)
                };
            }

            async mockRPS(choice) {
                await this.simulateDelay();
                this.checkRateLimit();

                const choices = ['rock', 'paper', 'scissors'];
                const houseChoice = choices[Math.floor(Math.random() * choices.length)];
                
                let result;
                if (choice === houseChoice) {
                    result = 'draw';
                } else if (
                    (choice === 'rock' && houseChoice === 'scissors') ||
                    (choice === 'paper' && houseChoice === 'rock') ||
                    (choice === 'scissors' && houseChoice === 'paper')
                ) {
                    result = 'win';
                } else {
                    result = 'lose';
                }

                return {
                    result,
                    houseChoice,
                    score: result === 'win' ? 30 : result === 'draw' ? 10 : 5
                };
            }

            async mockBlackjack() {
                await this.simulateDelay();
                this.checkRateLimit();

                const isWin = Math.random() > 0.4;
                return {
                    result: isWin ? 'win' : 'lose',
                    playerValue: Math.floor(Math.random() * 10) + 15,
                    dealerValue: Math.floor(Math.random() * 10) + 15,
                    score: isWin ? Math.floor(Math.random() * 100) + 50 : Math.floor(Math.random() * 20)
                };
            }

            addResult(game, result, score) {
                this.results.unshift({
                    game,
                    result,
                    score,
                    timestamp: new Date().toLocaleTimeString()
                });
                this.results = this.results.slice(0, 10); // Keep last 10 results
                this.updateResultsDisplay();
            }

            updateResultsDisplay() {
                const container = document.getElementById('results-container');
                const list = document.getElementById('results-list');
                
                if (this.results.length === 0) {
                    container.style.display = 'none';
                    return;
                }

                container.style.display = 'block';
                list.innerHTML = this.results.map(r => `
                    <div class="flex items-center justify-between text-sm">
                        <span class="text-nafl-grey-300 capitalize">${r.game.replace('-', ' ')}</span>
                        <span class="font-bold ${r.result === 'win' ? 'text-green-500' : r.result === 'lose' ? 'text-red-500' : 'text-yellow-500'}">
                            ${r.result.toUpperCase()}
                        </span>
                        <span class="text-nafl-grey-400">+${r.score}</span>
                        <span class="text-nafl-grey-500 text-xs">${r.timestamp}</span>
                    </div>
                `).join('');
            }

            reset() {
                this.requestCount = 0;
                this.results = [];
                this.updateResultsDisplay();
            }
        }

        const mockAPI = new MockGameAPI();
        console.log('‚úÖ MockGameAPI created successfully');

        // Game implementations
        function showGame(gameType, event) {
            console.log('üéÆ showGame called with:', gameType);
            const container = document.getElementById('game-container');
            
            // Update selector states
            document.querySelectorAll('.game-selector').forEach(btn => {
                btn.classList.remove('border-nafl-aqua-500');
                btn.classList.add('border-gray-600');
            });
            
            // Only update button state if event is provided
            if (event && event.target) {
                const button = event.target.closest('.game-selector');
                if (button) {
                    button.classList.add('border-nafl-aqua-500');
                    button.classList.remove('border-gray-600');
                }
            }

            switch(gameType) {
                case 'blackjack':
                    showBlackjack();
                    break;
                case 'coin-toss':
                    showCoinToss();
                    break;
                case 'rps':
                    showRPS();
                    break;
            }
        }

        let blackjackGameState = {
            gameActive: false,
            playerCards: [],
            dealerCards: [],
            playerValue: 0,
            dealerValue: 0
        };

        // Track which cards need animations
        let animatingCards = {
            dealer: new Set(),
            player: new Set(),
            dealerRevealing: new Set()
        };

        function showBlackjack() {
            const container = document.getElementById('game-container');
            container.innerHTML = `
                <div class="bg-gradient-to-br from-green-800 via-green-700 to-green-900 p-8 relative">
                    <!-- Start Game Overlay -->
                    <div id="start-game-overlay" class="absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center z-40" style="backdrop-filter: blur(3px);">
                        <div class="text-center">
                            <div class="text-4xl mb-4">üÉè</div>
                            <h3 class="text-2xl font-bold text-white mb-6">Ready to Play Blackjack?</h3>
                            <button onclick="startNewGame()" class="bg-nafl-aqua-500 hover:bg-nafl-aqua-600 text-white font-bold py-3 px-8 rounded-lg text-lg">
                                üéÆ Start Game
                            </button>
                        </div>
                    </div>

                    <!-- Game Result Overlay -->
                    <div id="blackjack-overlay" class="absolute inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50" style="display: none;">
                        <div id="blackjack-result" class="text-center">
                            <div id="result-text" class="text-6xl font-bold mb-4"></div>
                            <div id="result-details" class="text-xl text-white mb-6"></div>
                            <div class="flex gap-4">
                                <button onclick="showStartNewRoundOverlay()" class="bg-nafl-aqua-500 hover:bg-nafl-aqua-600 text-white font-bold py-3 px-8 rounded-lg text-lg">
                                    Start New Round
                                </button>
                                <button onclick="endGameSession()" class="bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-8 rounded-lg text-lg">
                                    End Game
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Blackjack Celebration Overlay -->
                    <div id="blackjack-celebration" class="absolute inset-0 flex items-center justify-center z-60" style="display: none; pointer-events: none;">
                        <div class="text-center">
                            <div class="text-6xl font-bold text-yellow-400 mb-4 celebration-text" style="text-shadow: 0 0 20px #ffd700;">
                                BLACKJACK!
                            </div>
                            <div class="text-4xl celebration-emojis">
                                üéâ‚ú®üéä
                            </div>
                        </div>
                    </div>

                    <!-- 21 Celebration Overlay -->
                    <div id="celebration-21" class="absolute inset-0 flex items-center justify-center z-60" style="display: none; pointer-events: none;">
                        <div class="text-center">
                            <div class="text-8xl font-bold text-green-400 mb-4 celebration-text" style="text-shadow: 0 0 20px #00ff00;">
                                21!
                            </div>
                            <div class="text-4xl celebration-emojis">
                                üéØüî•‚≠ê
                            </div>
                        </div>
                    </div>

                    <div class="text-center mb-6">
                        <h2 class="text-2xl font-bold text-white mb-2">üÉè Crypto Blackjack</h2>
                        <p class="text-green-200">Get as close to 21 without going over</p>
                    </div>
                    
                    <div class="max-w-4xl mx-auto">
                        <!-- Dealer Section -->
                        <div class="text-center mb-8">
                            <h3 class="text-lg font-bold text-white mb-4">Dealer</h3>
                            <div id="dealer-cards" class="relative min-h-[96px] flex items-center justify-center">
                                <!-- Cards will be dynamically added here with overlapping -->
                            </div>
                            <div id="dealer-value" class="text-white">Ready to deal</div>
                        </div>

                        <!-- Player Section -->
                        <div class="text-center mb-8">
                            <h3 class="text-lg font-bold text-white mb-4">You</h3>
                            <div id="player-section" class="flex justify-center items-center min-h-[120px]">
                                <!-- Regular hand display -->
                                <div id="regular-hand" class="flex flex-col items-center">
                                    <div id="player-cards" class="relative min-h-[96px] flex items-center justify-center">
                                        <!-- Cards will be dynamically added here with overlapping -->
                                    </div>
                                    <div id="player-value" class="text-white mt-2">Ready to play</div>
                                </div>
                                
                                <!-- Split hands display -->
                                <div id="split-hands" class="flex gap-48 items-center" style="display: none;">
                                    <div id="split-hand-0" class="flex flex-col items-center">
                                        <div id="split-cards-0" class="relative min-h-[96px] flex items-center justify-center">
                                            <!-- Split hand 0 cards -->
                                        </div>
                                        <div id="split-value-0" class="text-white text-sm mt-2">Hand 1</div>
                                    </div>
                                    <div id="split-hand-1" class="flex flex-col items-center">
                                        <div id="split-cards-1" class="relative min-h-[96px] flex items-center justify-center">
                                            <!-- Split hand 1 cards -->
                                        </div>
                                        <div id="split-value-1" class="text-white text-sm mt-2">Hand 2</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Action Buttons -->
                        <div id="action-buttons" class="flex justify-center gap-4 mb-6">
                            <button onclick="blackjackAction('hit')" id="hit-button" class="bg-yellow-500 hover:bg-yellow-600 text-black font-bold py-2 px-6 rounded-lg" style="display: none;">
                                üëÜ Hit
                            </button>
                            <button onclick="blackjackAction('stand')" id="stand-button" class="bg-nafl-aqua-500 hover:bg-nafl-aqua-600 text-white font-bold py-2 px-6 rounded-lg" style="display: none;">
                                ‚úã Stand
                            </button>
                            <button onclick="blackjackAction('double')" id="double-button" class="bg-gray-600 hover:bg-gray-500 text-white font-bold py-2 px-6 rounded-lg" style="display: none;">
                                ‚¨ÜÔ∏è Double
                            </button>
                            <button onclick="blackjackAction('split')" id="split-button" class="bg-gray-600 hover:bg-gray-500 text-white font-bold py-2 px-6 rounded-lg" style="display: none;">
                                ‚úÇÔ∏è Split
                            </button>
                        </div>

                        <!-- Betting Chips -->
                        <div class="flex justify-center gap-4">
                            <div class="chip bg-blue-600 border-blue-500 text-white">$10<br>ETH</div>
                            <div class="chip bg-orange-500 border-orange-400 text-white">$25<br>BTC</div>
                            <div class="chip bg-purple-600 border-purple-500 text-white">$50<br>SOL</div>
                            <div class="chip bg-indigo-600 border-indigo-500 text-white">$100<br>MATIC</div>
                        </div>
                    </div>
                </div>
            `;
            
            // Enhanced game state
            blackjackGameState = {
                gameActive: false,
                playerCards: [],
                dealerCards: [],
                playerValue: 0,
                dealerValue: 0,
                splitHands: null,
                currentSplitHand: 0,
                isAceSplit: false,
                hasPlayerBlackjack: false,
                hasDealerBlackjack: false,
                showStartOverlay: true
            };
            
            // Enhanced animation tracking
            animatingCards = {
                dealer: new Set(),
                player: new Set(),
                dealerRevealing: new Set(),
                splitShifting: false
            };
        }

        function showCoinToss() {
            const container = document.getElementById('game-container');
            container.innerHTML = `
                <div class="starry-bg p-8 relative min-h-96">
                    <!-- Stars -->
                    ${Array.from({length: 30}, (_, i) => `
                        <div class="star" style="left: ${Math.random() * 100}%; top: ${Math.random() * 100}%; animation-delay: ${Math.random() * 2}s;"></div>
                    `).join('')}
                    
                    <!-- Moon -->
                    <div class="moon"></div>
                    
                    <div class="text-center relative z-10">
                        <h2 class="text-2xl font-bold text-white mb-6">ü™ô Crypto Coin Toss</h2>
                        <p class="text-purple-200 mb-8">Watch the coin fly to the moon!</p>
                        
                        <!-- Coin -->
                        <div class="flex justify-center mb-8">
                            <div id="coin" class="coin bg-gradient-to-br from-yellow-400 to-yellow-600 border-yellow-500 text-black">
                                üê∏
                            </div>
                        </div>
                        
                        <!-- Choice Buttons -->
                        <div id="coin-choices" class="flex justify-center gap-8 mb-6">
                            <button onclick="coinTossChoice('heads')" class="bg-green-600 hover:bg-green-700 text-white font-bold py-4 px-8 rounded-lg text-lg">
                                üê∏ HEADS<br><span class="text-sm">Pepe</span>
                            </button>
                            <button onclick="coinTossChoice('tails')" class="bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 px-8 rounded-lg text-lg">
                                ‚Çø TAILS<br><span class="text-sm">Bitcoin</span>
                            </button>
                        </div>
                        
                        <div id="coin-result" class="text-xl font-bold" style="display: none;"></div>
                    </div>
                </div>
            `;
        }

        function showRPS() {
            const container = document.getElementById('game-container');
            container.innerHTML = `
                <div class="bg-gradient-to-br from-nafl-grey-800 via-nafl-grey-700 to-nafl-grey-900 p-8">
                    <div class="text-center mb-6">
                        <h2 class="text-2xl font-bold text-white mb-2">‚úä Rock Paper Scissors</h2>
                        <p class="text-nafl-grey-400">Make your choice within 30 seconds</p>
                    </div>
                    
                    <div class="max-w-4xl mx-auto">
                        <!-- Timer -->
                        <div class="text-center mb-8">
                            <div id="rps-timer" class="text-4xl font-bold text-nafl-aqua-500 mb-2">30</div>
                            <div class="text-nafl-grey-400">seconds remaining</div>
                        </div>
                        
                        <!-- Game Area -->
                        <div id="rps-game-area" class="text-center mb-8">
                            <div class="flex justify-center gap-16 mb-8">
                                <div class="text-center">
                                    <div class="text-white text-lg font-bold mb-4">You</div>
                                    <div id="player-gesture" class="gesture-button">?</div>
                                </div>
                                <div class="text-4xl text-white self-center">VS</div>
                                <div class="text-center">
                                    <div class="text-white text-lg font-bold mb-4">House</div>
                                    <div id="house-gesture" class="gesture-button">?</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Choice Buttons -->
                        <div id="rps-choices" class="flex justify-center gap-6">
                            <button onclick="rpsChoice('rock')" class="gesture-button">‚úä</button>
                            <button onclick="rpsChoice('paper')" class="gesture-button">‚úã</button>
                            <button onclick="rpsChoice('scissors')" class="gesture-button">‚úåÔ∏è</button>
                        </div>
                        
                        <div id="rps-result" class="text-center mt-6" style="display: none;">
                            <div id="rps-outcome" class="text-2xl font-bold mb-2"></div>
                            <div id="rps-explanation" class="text-nafl-grey-300"></div>
                        </div>
                    </div>
                </div>
            `;
            
            startRPSTimer();
        }

        function startNewGame() {
            // Hide start overlay
            const overlay = document.getElementById('start-game-overlay');
            if (overlay) {
                overlay.style.display = 'none';
            }
            dealNewHand();
        }

        function showStartNewRoundOverlay() {
            // Hide result overlay
            const resultOverlay = document.getElementById('blackjack-overlay');
            if (resultOverlay) {
                resultOverlay.style.display = 'none';
            }
            // Show start overlay again
            const startOverlay = document.getElementById('start-game-overlay');
            if (startOverlay) {
                startOverlay.style.display = 'flex';
                // Update text for new round
                const title = startOverlay.querySelector('h3');
                const button = startOverlay.querySelector('button');
                if (title) title.textContent = 'Ready for Another Round?';
                if (button) button.innerHTML = 'üéÆ Start New Round';
            }
        }

        function triggerBlackjackCelebration() {
            const celebration = document.getElementById('blackjack-celebration');
            if (celebration) {
                celebration.style.display = 'flex';
                setTimeout(() => {
                    celebration.style.display = 'none';
                }, 1000);
            }
        }

        function trigger21Celebration() {
            const celebration = document.getElementById('celebration-21');
            if (celebration) {
                celebration.style.display = 'flex';
                setTimeout(() => {
                    celebration.style.display = 'none';
                }, 1000);
            }
        }

        function endGameSession() {
            // Hide result overlay
            const resultOverlay = document.getElementById('blackjack-overlay');
            if (resultOverlay) {
                resultOverlay.style.display = 'none';
            }
            
            // Reset game state
            blackjackGameState = {
                gameActive: false,
                playerCards: [],
                dealerCards: [],
                playerValue: 0,
                dealerValue: 0,
                splitHands: null,
                currentSplitHand: 0,
                isAceSplit: false,
                hasPlayerBlackjack: false,
                hasDealerBlackjack: false,
                showStartOverlay: true
            };
            
            // Reset animations
            animatingCards = {
                dealer: new Set(),
                player: new Set(),
                dealerRevealing: new Set(),
                splitShifting: false
            };
            
            // Show start overlay
            const startOverlay = document.getElementById('start-game-overlay');
            if (startOverlay) {
                startOverlay.style.display = 'flex';
                // Reset to initial text
                const title = startOverlay.querySelector('h3');
                const button = startOverlay.querySelector('button');
                if (title) title.textContent = 'Ready to Play Blackjack?';
                if (button) button.innerHTML = 'üéÆ Start Game';
            }
        }

        // Blackjack card generation
        function generateRandomCard() {
            const suits = ['‚ô†', '‚ô•', '‚ô¶', '‚ô£'];
            const values = ['A', '2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K'];
            const suit = suits[Math.floor(Math.random() * suits.length)];
            const value = values[Math.floor(Math.random() * values.length)];
            
            let numericValue;
            if (value === 'A') {
                numericValue = 11; // Will be adjusted for aces later
            } else if (['J', 'Q', 'K'].includes(value)) {
                numericValue = 10;
            } else {
                numericValue = parseInt(value);
            }
            
            return { suit, value, numericValue };
        }

        function calculateHandValue(cards) {
            let value = 0;
            let aces = 0;
            
            for (let card of cards) {
                if (card.value === 'A') {
                    aces++;
                    value += 11;
                } else {
                    value += card.numericValue;
                }
            }
            
            // Adjust for aces
            while (value > 21 && aces > 0) {
                value -= 10;
                aces--;
            }
            
            return value;
        }

        // Enhanced blackjack detection
        function detectBlackjack(cards) {
            return cards.length === 2 && calculateHandValue(cards) === 21;
        }

        // Enhanced split logic for any pair
        function canSplit(cards) {
            if (cards.length !== 2) return false;
            
            const card1 = cards[0];
            const card2 = cards[1];
            
            // Can split if same value or same rank (10-J, Q-K, etc.)
            return card1.value === card2.value || 
                   (card1.numericValue === 10 && card2.numericValue === 10);
        }

        function createCardElement(card, isHidden = false, shouldAnimate = false, index = 0, player = 'player', isRevealing = false) {
            const animationClass = shouldAnimate ? (isRevealing ? 'card-reveal' : 'card-deal') : '';
            
            // Enhanced overlapping positioning (60% overlap)
            const cardWidth = 64; // Card width in pixels
            const overlapAmount = cardWidth * 0.6; // 60% overlap
            const xPosition = index * (cardWidth - overlapAmount);
            const rotation = player === 'dealer' ? index * 2 - 1 : index * -2 + 1;
            const zIndex = index + 1; // Newest card on top
            
            const positionStyle = `
                position: absolute;
                transform: translateX(${xPosition}px) rotate(${rotation}deg);
                z-index: ${zIndex};
            `;
            
            if (isHidden) {
                return `
                    <div class="card bg-blue-900 border-blue-700 ${animationClass}" style="${positionStyle}">
                        <div class="text-white text-center text-2xl">?</div>
                    </div>
                `;
            }
            
            const isRed = ['‚ô•', '‚ô¶'].includes(card.suit);
            const color = isRed ? 'text-red-600' : 'text-black';
            
            return `
                <div class="card ${animationClass}" style="${positionStyle}">
                    <!-- Top-left corner -->
                    <div class="absolute top-1 left-1 text-xs font-bold ${color} leading-none">
                        ${card.value}<br><span class="text-sm">${card.suit}</span>
                    </div>
                    
                    <!-- Bottom-right corner (rotated) -->
                    <div class="absolute bottom-1 right-1 text-xs font-bold ${color} transform rotate-180 leading-none">
                        ${card.value}<br><span class="text-sm">${card.suit}</span>
                    </div>
                </div>
            `;
        }

        function updateDisplay() {
            const dealerCardsContainer = document.getElementById('dealer-cards');
            const dealerValueElement = document.getElementById('dealer-value');
            
            // Update dealer cards with enhanced overlapping and minimal animation
            let dealerCardsHTML = '';
            blackjackGameState.dealerCards.forEach((card, index) => {
                const isHidden = index === 1 && blackjackGameState.gameActive && !blackjackGameState.hasPlayerBlackjack && !blackjackGameState.hasDealerBlackjack;
                const shouldAnimate = animatingCards.dealer.has(index);
                const isRevealing = animatingCards.dealerRevealing.has(index);
                dealerCardsHTML += createCardElement(card, isHidden, shouldAnimate, index, 'dealer', isRevealing);
            });
            dealerCardsContainer.innerHTML = dealerCardsHTML;
            
            // Dealer value display
            if (blackjackGameState.gameActive && !blackjackGameState.hasPlayerBlackjack && !blackjackGameState.hasDealerBlackjack) {
                dealerValueElement.textContent = `Dealer: ${blackjackGameState.dealerCards[0].numericValue}`;
            } else {
                let dealerText = `Dealer: ${blackjackGameState.dealerValue}`;
                if (blackjackGameState.hasDealerBlackjack) {
                    dealerText += ' BLACKJACK!';
                }
                dealerValueElement.textContent = dealerText;
            }
            
            // Player display - handle split hands vs regular hands
            if (blackjackGameState.splitHands) {
                // Show split hands display
                document.getElementById('regular-hand').style.display = 'none';
                document.getElementById('split-hands').style.display = 'flex';
                
                // Update both split hands
                blackjackGameState.splitHands.forEach((hand, handIndex) => {
                    const cardsContainer = document.getElementById(`split-cards-${handIndex}`);
                    const valueElement = document.getElementById(`split-value-${handIndex}`);
                    
                    // Generate cards HTML for this hand
                    let cardsHTML = '';
                    hand.forEach((card, cardIndex) => {
                        const shouldAnimate = animatingCards.player.has(cardIndex) && handIndex === blackjackGameState.currentSplitHand;
                        cardsHTML += createCardElement(card, false, shouldAnimate, cardIndex, 'player');
                    });
                    cardsContainer.innerHTML = cardsHTML;
                    
                    // Update value display
                    const handValue = calculateHandValue(hand);
                    let valueText = `Hand ${handIndex + 1}: ${handValue}`;
                    
                    // Highlight active hand
                    if (handIndex === blackjackGameState.currentSplitHand) {
                        valueElement.className = 'text-nafl-aqua-500 text-sm mt-2 font-bold';
                    } else {
                        valueElement.className = 'text-white text-sm mt-2';
                    }
                    
                    // Add status indicators
                    if (handValue > 21) {
                        valueText += ' <span class="text-red-500">BUST!</span>';
                    } else if (handValue === 21) {
                        valueText += ' <span class="text-yellow-500">21!</span>';
                    }
                    
                    valueElement.innerHTML = valueText;
                });
            } else {
                // Show regular hand display
                document.getElementById('regular-hand').style.display = 'flex';
                document.getElementById('split-hands').style.display = 'none';
                
                const playerCardsContainer = document.getElementById('player-cards');
                const playerValueElement = document.getElementById('player-value');
                
                // Update player cards
                let playerCardsHTML = '';
                blackjackGameState.playerCards.forEach((card, index) => {
                    const shouldAnimate = animatingCards.player.has(index);
                    playerCardsHTML += createCardElement(card, false, shouldAnimate, index, 'player');
                });
                playerCardsContainer.innerHTML = playerCardsHTML;
                
                // Update player value
                let playerText = `You: ${blackjackGameState.playerValue}`;
                if (blackjackGameState.playerValue > 21) {
                    playerText += ' <span class="text-red-500 font-bold">BUST!</span>';
                } else if (blackjackGameState.hasPlayerBlackjack) {
                    playerText += ' <span class="text-yellow-500 font-bold">BLACKJACK!</span>';
                }
                playerValueElement.innerHTML = playerText;
            }
        }

        function showGameButtons() {
            const hitButton = document.getElementById('hit-button');
            const standButton = document.getElementById('stand-button');
            const doubleButton = document.getElementById('double-button');
            const splitButton = document.getElementById('split-button');
            
            // Show basic buttons
            hitButton.style.display = 'inline-block';
            standButton.style.display = 'inline-block';
            
            // Show double button if allowed (first two cards or split hands)
            const canDouble = !blackjackGameState.splitHands || !blackjackGameState.isAceSplit;
            doubleButton.style.display = canDouble ? 'inline-block' : 'none';
            
            // Show split button if allowed
            const canSplitCards = !blackjackGameState.splitHands && 
                                 blackjackGameState.playerCards.length === 2 && 
                                 canSplit(blackjackGameState.playerCards);
            splitButton.style.display = canSplitCards ? 'inline-block' : 'none';
        }

        function hideGameButtons() {
            document.getElementById('hit-button').style.display = 'none';
            document.getElementById('stand-button').style.display = 'none';
            document.getElementById('double-button').style.display = 'none';
            document.getElementById('split-button').style.display = 'none';
        }

        async function dealNewHand() {
            try {
                // Generate new cards
                const playerCards = [generateRandomCard(), generateRandomCard()];
                const dealerCards = [generateRandomCard(), generateRandomCard()];
                const playerValue = calculateHandValue(playerCards);
                const dealerValue = calculateHandValue(dealerCards);
                const fullDealerValue = calculateHandValue(dealerCards);
                
                const hasPlayerBlackjack = detectBlackjack(playerCards);
                const hasDealerBlackjack = detectBlackjack(dealerCards);
                
                // Enhanced game state
                blackjackGameState = {
                    gameActive: true,
                    playerCards,
                    dealerCards,
                    playerValue,
                    dealerValue: dealerCards[0].numericValue, // Only show first dealer card initially
                    splitHands: null,
                    currentSplitHand: 0,
                    isAceSplit: false,
                    hasPlayerBlackjack,
                    hasDealerBlackjack,
                    showStartOverlay: false
                };
                
                // Enhanced animation tracking
                animatingCards = {
                    dealer: new Set([0, 1]), // Both dealer cards animate in
                    player: new Set([0, 1]), // Both player cards animate in
                    dealerRevealing: new Set(),
                    splitShifting: false
                };
                
                // Update display with initial cards
                updateDisplay();
                
                // Enhanced blackjack detection and immediate resolution
                if (hasPlayerBlackjack) {
                    // Trigger blackjack celebration
                    triggerBlackjackCelebration();
                    
                    // Player has blackjack - reveal dealer hole card
                    blackjackGameState.dealerValue = fullDealerValue;
                    
                    setTimeout(() => {
                        // Reveal dealer hole card animation
                        animatingCards.dealerRevealing.add(1);
                        updateDisplay();
                        
                        setTimeout(() => {
                            if (hasDealerBlackjack) {
                                // Both have blackjack - push
                                endGame('push', 'Both have blackjack - Push!');
                            } else {
                                // Player wins with blackjack
                                endGame('win', 'Blackjack! You win!');
                            }
                        }, 1000);
                    }, 1000);
                    
                } else if (hasDealerBlackjack) {
                    // Dealer has blackjack - reveal and end game
                    blackjackGameState.dealerValue = fullDealerValue;
                    
                    setTimeout(() => {
                        // Reveal dealer hole card animation
                        animatingCards.dealerRevealing.add(1);
                        updateDisplay();
                        
                        setTimeout(() => {
                            endGame('lose', 'Dealer Blackjack! House wins!');
                        }, 1000);
                    }, 1000);
                } else {
                    // Normal game - show action buttons
                    showGameButtons();
                }
                
                // Clear animations after they complete
                setTimeout(() => {
                    animatingCards = {
                        dealer: new Set(),
                        player: new Set(),
                        dealerRevealing: new Set(),
                        splitShifting: false
                    };
                }, 1500);
                
            } catch (error) {
                alert(error.message);
            }
        }

        async function blackjackAction(action) {
            if (!blackjackGameState.gameActive) return;
            
            try {
                if (action === 'hit') {
                    if (blackjackGameState.splitHands) {
                        // Handle split hands
                        const currentHand = blackjackGameState.splitHands[blackjackGameState.currentSplitHand];
                        currentHand.push(generateRandomCard());
                        
                        // Mark only the new card for animation
                        animatingCards.player.add(currentHand.length - 1);
                        
                        const handValue = calculateHandValue(currentHand);
                        blackjackGameState.playerCards = currentHand;
                        blackjackGameState.playerValue = handValue;
                        
                        updateDisplay();
                        
                        // Clear animation after it completes
                        setTimeout(() => {
                            animatingCards.player.clear();
                        }, 800);
                        
                        if (handValue > 21 || handValue === 21) {
                            // Move to next split hand or dealer turn
                            if (blackjackGameState.currentSplitHand < blackjackGameState.splitHands.length - 1) {
                                blackjackGameState.currentSplitHand++;
                                
                                // Deal second card to the second split hand if it doesn't have one
                                if (blackjackGameState.splitHands[blackjackGameState.currentSplitHand].length === 1) {
                                    blackjackGameState.splitHands[blackjackGameState.currentSplitHand].push(generateRandomCard());
                                }
                                
                                blackjackGameState.playerCards = blackjackGameState.splitHands[blackjackGameState.currentSplitHand];
                                blackjackGameState.playerValue = calculateHandValue(blackjackGameState.splitHands[blackjackGameState.currentSplitHand]);
                                updateDisplay();
                                showGameButtons();
                            } else {
                                // All split hands complete
                                dealerPlay();
                            }
                        } else {
                            showGameButtons();
                        }
                    } else {
                        // Regular hand
                        blackjackGameState.playerCards.push(generateRandomCard());
                        
                        // Mark only the new card for animation
                        animatingCards.player.add(blackjackGameState.playerCards.length - 1);
                        
                        blackjackGameState.playerValue = calculateHandValue(blackjackGameState.playerCards);
                        updateDisplay();
                        
                        // Clear animation after it completes
                        setTimeout(() => {
                            animatingCards.player.clear();
                        }, 800);
                        
                        // Check for bust
                        if (blackjackGameState.playerValue > 21) {
                            setTimeout(() => endGame('lose', 'Player busts!'), 500);
                            return;
                        }
                        
                        // Check for 21
                        if (blackjackGameState.playerValue === 21) {
                            trigger21Celebration();
                            setTimeout(() => blackjackAction('stand'), 500);
                            return;
                        }
                        
                        showGameButtons();
                    }
                    
                } else if (action === 'stand') {
                    if (blackjackGameState.splitHands && blackjackGameState.currentSplitHand < blackjackGameState.splitHands.length - 1) {
                        // Move to next split hand and deal its second card
                        blackjackGameState.currentSplitHand++;
                        
                        // Deal second card to the second split hand if it doesn't have one
                        if (blackjackGameState.splitHands[blackjackGameState.currentSplitHand].length === 1) {
                            blackjackGameState.splitHands[blackjackGameState.currentSplitHand].push(generateRandomCard());
                        }
                        
                        blackjackGameState.playerCards = blackjackGameState.splitHands[blackjackGameState.currentSplitHand];
                        blackjackGameState.playerValue = calculateHandValue(blackjackGameState.splitHands[blackjackGameState.currentSplitHand]);
                        updateDisplay();
                        showGameButtons();
                    } else {
                        // Move to dealer turn
                        dealerPlay();
                    }
                    
                } else if (action === 'double') {
                    if (blackjackGameState.splitHands) {
                        // Handle double on split hand
                        const currentHand = blackjackGameState.splitHands[blackjackGameState.currentSplitHand];
                        currentHand.push(generateRandomCard());
                        
                        animatingCards.player.add(currentHand.length - 1);
                        blackjackGameState.playerCards = currentHand;
                        blackjackGameState.playerValue = calculateHandValue(currentHand);
                        updateDisplay();
                        
                        setTimeout(() => {
                            animatingCards.player.clear();
                            
                            if (blackjackGameState.currentSplitHand < blackjackGameState.splitHands.length - 1) {
                                // Move to next split hand and deal its second card
                                blackjackGameState.currentSplitHand++;
                                
                                // Deal second card to the second split hand if it doesn't have one
                                if (blackjackGameState.splitHands[blackjackGameState.currentSplitHand].length === 1) {
                                    blackjackGameState.splitHands[blackjackGameState.currentSplitHand].push(generateRandomCard());
                                }
                                
                                blackjackGameState.playerCards = blackjackGameState.splitHands[blackjackGameState.currentSplitHand];
                                blackjackGameState.playerValue = calculateHandValue(blackjackGameState.splitHands[blackjackGameState.currentSplitHand]);
                                updateDisplay();
                                showGameButtons();
                            } else {
                                // All split hands complete
                                dealerPlay();
                            }
                        }, 800);
                    } else {
                        // Regular double
                        blackjackGameState.playerCards.push(generateRandomCard());
                        animatingCards.player.add(blackjackGameState.playerCards.length - 1);
                        blackjackGameState.playerValue = calculateHandValue(blackjackGameState.playerCards);
                        updateDisplay();
                        
                        setTimeout(() => {
                            animatingCards.player.clear();
                            
                            if (blackjackGameState.playerValue > 21) {
                                endGame('lose', 'Player busts after double down!');
                            } else {
                                dealerPlay();
                            }
                        }, 800);
                    }
                    
                } else if (action === 'split') {
                    // Proper casino split functionality
                    const originalCards = blackjackGameState.playerCards;
                    const isAceSplit = originalCards[0].value === 'A';
                    
                    // Create two hands from the split - each gets one card from original pair
                    const splitHands = [
                        [originalCards[0]], // First hand with first card only
                        [originalCards[1]]  // Second hand with second card only
                    ];
                    
                    // Deal second card ONLY to first hand initially
                    // Second hand remains with one card until first hand is completed
                    splitHands[0].push(generateRandomCard());
                    
                    blackjackGameState.splitHands = splitHands;
                    blackjackGameState.currentSplitHand = 0;
                    blackjackGameState.isAceSplit = isAceSplit;
                    blackjackGameState.playerCards = splitHands[0]; // Show first hand as active
                    blackjackGameState.playerValue = calculateHandValue(splitHands[0]);
                    
                    // Animate split repositioning
                    animatingCards.splitShifting = true;
                    animatingCards.player.add(1); // New card for first split hand
                    
                    updateDisplay();
                    
                    // Clear animations after they complete
                    setTimeout(() => {
                        animatingCards.splitShifting = false;
                        animatingCards.player.clear();
                    }, 1000);
                    
                    // Special handling for split Aces - they get only one card each and are automatically completed
                    if (isAceSplit) {
                        // Deal second card to second hand as well for Aces
                        splitHands[1].push(generateRandomCard());
                        
                        setTimeout(() => {
                            // Both hands are complete with split Aces - no further actions allowed
                            dealerPlay();
                        }, 1000);
                    } else {
                        // For non-Ace splits, continue with first hand
                        const firstHandValue = calculateHandValue(splitHands[0]);
                        if (firstHandValue === 21) {
                            // First hand has 21, move to second hand and deal its second card
                            setTimeout(() => {
                                blackjackGameState.currentSplitHand = 1;
                                splitHands[1].push(generateRandomCard());
                                blackjackGameState.playerCards = splitHands[1];
                                blackjackGameState.playerValue = calculateHandValue(splitHands[1]);
                                updateDisplay();
                                
                                const secondHandValue = calculateHandValue(splitHands[1]);
                                if (secondHandValue === 21) {
                                    // Both hands have 21, move to dealer
                                    setTimeout(() => dealerPlay(), 500);
                                } else {
                                    showGameButtons();
                                }
                            }, 500);
                        } else {
                            // Continue playing first hand normally
                            setTimeout(() => showGameButtons(), 1000);
                        }
                    }
                }
                
            } catch (error) {
                alert(error.message);
            }
        }

        async function dealerPlay() {
            blackjackGameState.gameActive = false;
            hideGameButtons();
            
            // Reveal dealer's hidden card first and update score immediately
            const fullDealerValue = calculateHandValue(blackjackGameState.dealerCards);
            blackjackGameState.dealerValue = fullDealerValue;
            
            animatingCards.dealerRevealing.add(1);
            updateDisplay();
            
            // Wait for reveal animation
            await new Promise(resolve => setTimeout(resolve, 600));
            animatingCards.dealerRevealing.clear();
            
            // Dealer hits until 17 or higher
            while (blackjackGameState.dealerValue < 17) {
                await new Promise(resolve => setTimeout(resolve, 1000));
                blackjackGameState.dealerCards.push(generateRandomCard());
                
                // Mark only the new dealer card for animation
                animatingCards.dealer.add(blackjackGameState.dealerCards.length - 1);
                blackjackGameState.dealerValue = calculateHandValue(blackjackGameState.dealerCards);
                updateDisplay();
                
                // Wait for animation
                await new Promise(resolve => setTimeout(resolve, 800));
                animatingCards.dealer.clear();
            }
            
            // Determine winner(s)
            setTimeout(() => {
                if (blackjackGameState.splitHands) {
                    // Handle split hands results
                    const results = blackjackGameState.splitHands.map(hand => {
                        const handValue = calculateHandValue(hand);
                        if (handValue > 21) return 'lose';
                        if (blackjackGameState.dealerValue > 21) return 'win';
                        if (handValue > blackjackGameState.dealerValue) return 'win';
                        if (handValue < blackjackGameState.dealerValue) return 'lose';
                        return 'push';
                    });
                    
                    const wins = results.filter(r => r === 'win').length;
                    const losses = results.filter(r => r === 'lose').length;
                    const pushes = results.filter(r => r === 'push').length;
                    
                    let overallResult, details;
                    if (wins > losses) {
                        overallResult = 'win';
                        details = `Split hands: ${wins} wins, ${losses} losses, ${pushes} pushes`;
                    } else if (losses > wins) {
                        overallResult = 'lose';
                        details = `Split hands: ${wins} wins, ${losses} losses, ${pushes} pushes`;
                    } else {
                        overallResult = 'push';
                        details = `Split hands: ${wins} wins, ${losses} losses, ${pushes} pushes`;
                    }
                    
                    endGame(overallResult, details);
                } else {
                    // Regular hand result
                    if (blackjackGameState.dealerValue > 21) {
                        endGame('win', 'Dealer busts!');
                    } else if (blackjackGameState.playerValue > blackjackGameState.dealerValue) {
                        endGame('win', `${blackjackGameState.playerValue} beats ${blackjackGameState.dealerValue}`);
                    } else if (blackjackGameState.playerValue < blackjackGameState.dealerValue) {
                        endGame('lose', `${blackjackGameState.dealerValue} beats ${blackjackGameState.playerValue}`);
                    } else {
                        endGame('push', `Both have ${blackjackGameState.playerValue} - Push!`);
                    }
                }
            }, 1000);
        }

        function endGame(result, details) {
            blackjackGameState.gameActive = false;
            hideGameButtons();
            
            // Add to results
            const score = result === 'win' ? Math.floor(Math.random() * 100) + 50 : 
                         result === 'push' ? 25 : Math.floor(Math.random() * 20);
            mockAPI.addResult('blackjack', result, score);
            
            // Wait 0.5 seconds before showing overlay
            setTimeout(() => {
                const overlay = document.getElementById('blackjack-overlay');
                const resultText = document.getElementById('result-text');
                const resultDetails = document.getElementById('result-details');
                
                let resultMessage, resultColor;
                if (result === 'win') {
                    resultMessage = 'YOU WIN!';
                    resultColor = 'text-green-500';
                } else if (result === 'lose') {
                    resultMessage = 'YOU LOSE!';
                    resultColor = 'text-red-500';
                } else {
                    resultMessage = 'PUSH!';
                    resultColor = 'text-yellow-500';
                }
                
                resultText.textContent = resultMessage;
                resultText.className = `text-6xl font-bold mb-4 ${resultColor}`;
                resultDetails.textContent = details;
                
                overlay.style.display = 'flex';
            }, 500);
            
            // Auto-hide overlay after 3 seconds
            setTimeout(() => {
                overlay.style.display = 'none';
            }, 3000);
        }

        async function coinTossChoice(choice) {
            try {
                const coin = document.getElementById('coin');
                const choices = document.getElementById('coin-choices');
                const resultDiv = document.getElementById('coin-result');
                
                // Hide choices and start animation
                choices.style.display = 'none';
                coin.classList.add('spinning');
                
                const result = await mockAPI.mockCoinToss(choice);
                
                // Stop spinning and show result
                coin.classList.remove('spinning');
                coin.classList.add('bounce');
                coin.textContent = result.outcome === 'heads' ? 'üê∏' : '‚Çø';
                coin.className = coin.className.replace(/bg-gradient-to-br from-yellow-400 to-yellow-600/, 
                    result.outcome === 'heads' ? 'bg-gradient-to-br from-green-400 to-green-600' : 'bg-gradient-to-br from-orange-400 to-orange-600');
                
                // Show result
                setTimeout(() => {
                    const resultText = result.result === 'win' ? 'YOU WIN!' : 'YOU LOSE!';
                    const resultColor = result.result === 'win' ? 'text-green-500' : 'text-red-500';
                    
                    resultDiv.innerHTML = `
                        <div class="${resultColor}">${resultText}</div>
                        <div class="text-white mt-2">Result: ${result.outcome === 'heads' ? 'üê∏ HEADS' : '‚Çø TAILS'}</div>
                    `;
                    resultDiv.style.display = 'block';
                    
                    mockAPI.addResult('coin-toss', result.result, result.score);
                    
                    // Reset after 3 seconds
                    setTimeout(() => {
                        showCoinToss();
                    }, 3000);
                }, 1000);
                
            } catch (error) {
                alert(error.message);
                document.getElementById('coin-choices').style.display = 'flex';
            }
        }

        let rpsTimer;
        let rpsTimeLeft = 30;

        function startRPSTimer() {
            rpsTimeLeft = 30;
            rpsTimer = setInterval(() => {
                rpsTimeLeft--;
                document.getElementById('rps-timer').textContent = rpsTimeLeft;
                
                if (rpsTimeLeft <= 10) {
                    document.getElementById('rps-timer').className = 'text-4xl font-bold text-red-500 mb-2';
                }
                
                if (rpsTimeLeft <= 0) {
                    clearInterval(rpsTimer);
                    // Auto-select random choice
                    const choices = ['rock', 'paper', 'scissors'];
                    const randomChoice = choices[Math.floor(Math.random() * choices.length)];
                    rpsChoice(randomChoice, true);
                }
            }, 1000);
        }

        async function rpsChoice(choice, autoSelected = false) {
            try {
                clearInterval(rpsTimer);
                
                const playerGesture = document.getElementById('player-gesture');
                const houseGesture = document.getElementById('house-gesture');
                const choices = document.getElementById('rps-choices');
                const resultDiv = document.getElementById('rps-result');
                const outcomeDiv = document.getElementById('rps-outcome');
                const explanationDiv = document.getElementById('rps-explanation');
                
                // Hide choices
                choices.style.display = 'none';
                
                // Show player choice
                const gestures = { rock: '‚úä', paper: '‚úã', scissors: '‚úåÔ∏è' };
                playerGesture.textContent = gestures[choice];
                playerGesture.classList.add('selected');
                
                if (autoSelected) {
                    playerGesture.style.background = '#f59e0b'; // Orange for auto-selected
                }
                
                const result = await mockAPI.mockRPS(choice);
                
                // Show house choice
                houseGesture.textContent = gestures[result.houseChoice];
                if (result.result === 'lose') {
                    houseGesture.classList.add('selected');
                }
                
                // Show result
                setTimeout(() => {
                    const resultText = result.result === 'win' ? 'YOU WIN!' : 
                                     result.result === 'lose' ? 'YOU LOSE!' : "IT'S A TIE!";
                    const resultColor = result.result === 'win' ? 'text-green-500' : 
                                       result.result === 'lose' ? 'text-red-500' : 'text-yellow-500';
                    
                    outcomeDiv.className = `text-2xl font-bold mb-2 ${resultColor}`;
                    outcomeDiv.textContent = resultText;
                    
                    // Explanation
                    let explanation = '';
                    if (result.result === 'draw') {
                        explanation = `Both played ${choice}. It's a tie!`;
                    } else if (result.result === 'win') {
                        if (choice === 'rock' && result.houseChoice === 'scissors') explanation = 'Rock crushes scissors. You win!';
                        if (choice === 'paper' && result.houseChoice === 'rock') explanation = 'Paper covers rock. You win!';
                        if (choice === 'scissors' && result.houseChoice === 'paper') explanation = 'Scissors cuts paper. You win!';
                    } else {
                        if (result.houseChoice === 'rock' && choice === 'scissors') explanation = 'Rock crushes scissors. House wins!';
                        if (result.houseChoice === 'paper' && choice === 'rock') explanation = 'Paper covers rock. House wins!';
                        if (result.houseChoice === 'scissors' && choice === 'paper') explanation = 'Scissors cuts paper. House wins!';
                    }
                    
                    explanationDiv.textContent = explanation;
                    resultDiv.style.display = 'block';
                    
                    mockAPI.addResult('rps', result.result, result.score);
                    
                    // Reset after 4 seconds
                    setTimeout(() => {
                        showRPS();
                    }, 4000);
                }, 1500);
                
            } catch (error) {
                alert(error.message);
                document.getElementById('rps-choices').style.display = 'flex';
                startRPSTimer();
            }
        }

        function resetDemo() {
            mockAPI.reset();
            document.getElementById('game-container').innerHTML = `
                <div class="p-8 text-center">
                    <div class="text-6xl mb-4">üéÆ</div>
                    <h2 class="text-2xl font-bold mb-2">Select a Game to Start</h2>
                    <p class="text-nafl-grey-400">Choose from Blackjack, Coin Toss, or Rock Paper Scissors above</p>
                </div>
            `;
            
            // Reset selector states
            document.querySelectorAll('.game-selector').forEach(btn => {
                btn.classList.remove('border-nafl-aqua-500');
                btn.classList.add('border-gray-600');
            });
        }

        // Initialize
        console.log('üéÆ Naffles Games Demo loaded successfully!');
        console.log('‚úÖ Mock API system active');
        console.log('üéØ No backend required');
        console.log('üîç showGame function defined:', typeof showGame);
    </script>
</body>
</html>